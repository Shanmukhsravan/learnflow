<!DOCTYPE html>
<html>
<head>
    <title>LearnFlow Dashboard</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">

{% if notifications %}
<div style="position:fixed; top:20px; right:20px; z-index:9999;">
    {% for note in notifications %}
    <div class="notification-toast">
        üîî {{ note.message }}
    </div>
    {% endfor %}
</div>
{% endif %}

<style>
    /* Top Navbar Profile */
.dropdown-toggle {
    border-radius: 30px;
    padding: 8px 18px;
}

.dropdown-menu {
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
}

.notification-toast{
    background:#4f46e5;
    color:white;
    padding:15px 25px;
    border-radius:12px;
    margin-bottom:10px;
    box-shadow:0 8px 25px rgba(0,0,0,0.25);
    animation: slideFade 6s ease forwards;
}

@keyframes slideFade {
    0% { transform: translateX(100%); opacity: 0; }
    10% { transform: translateX(0); opacity: 1; }
    85% { transform: translateX(0); opacity: 1; }
    100% { transform: translateX(100%); opacity: 0; }
}
</style>

</head>

<body>

<!-- PAGE LOADER -->
<div id="pageLoader" class="page-loader">
    <div class="spinner-border text-primary"></div>
</div>

<div class="container-fluid">
<div class="row">

<!-- SIDEBAR -->
<div class="col-md-2 sidebar">

    <div class="d-flex justify-content-between align-items-center">
        <h4 class="logo">LearnFlow</h4>
        <button class="btn btn-sm btn-light d-md-none" onclick="toggleSidebar()">‚ò∞</button>
    </div>

    <a href="/dashboard">Dashboard</a>
    <a href="/batches">Batches</a>
    <a href="{{ url_for('tests') }}">Tests</a>
    

    <!-- DARK MODE -->
    <div class="form-check form-switch mt-4">
        <input class="form-check-input" type="checkbox" id="darkToggle">
        <label class="form-check-label text-muted">Dark Mode</label>
    </div>


</div>
<!-- HERO SECTION -->
 <div class="col-md-10 main p-4">
<div class="hero d-flex justify-content-between align-items-start">

    <!-- LEFT SIDE -->
    <div>
        <h2>AI Learning Insights</h2>
        <p>Your personalized learning performance overview</p>
    </div>

    <!-- RIGHT SIDE (Profile Dropdown) -->
    <div class="dropdown">
        <button class="btn btn-light dropdown-toggle shadow-sm"
                data-bs-toggle="dropdown">
            üë§ {{ name }}
        </button>

        <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="#">Profile</a></li>
            <li><a class="dropdown-item" href="/logout">Logout ‚èª</a></li>
        </ul>
    </div>

</div>

<h2>Welcome back, {{name}} üëã</h2>
<p>Track your progress, attempt tests, and level up your learning.</p>


<!-- METRICS -->
<div class="row">

    <div class="col-md-3">
        <div class="metric-card">
            <h6>Total Tests</h6>
            <h2 class="counter" data-target="{{ total_tests }}">{{ total_tests }}</h2>
        </div>
    </div>

    <div class="col-md-3">
        <div class="metric-card">
            <h6>Average Score</h6>
            <h2 class="counter" data-target="{{ avg_score }}">{{ avg_score }} </h2> %
        </div>
    </div>

    <div class="col-md-3">
        <div class="metric-card">
            <h6>Status</h6>
            <h5>{{ status }}</h5>
        </div>
    </div>

    <div class="col-md-3">
        <div class="metric-card">
            <h6>Consistency</h6>

            {% if avg_score >= 75 %}
                <h5 class="text-success">High üî•</h5>
            {% elif avg_score > 0 %}
                <h5 class="text-warning">Improving ‚è≥</h5>
            {% else %}
                <h5 class="text-secondary">No Data</h5>
            {% endif %}

        </div>
    </div>

</div>

<!-- RECOMMENDATION -->
<div class="card mt-4 p-3 shadow-sm">
    <h5>üéØ Personalized Recommendation</h5>
    <p>{{ recommendation }}</p>
    <a href="/batches" class="btn btn-primary btn-sm">Explore Batches</a>
</div>

<!-- CHART -->
<div class="card mt-4 p-3 shadow-sm">
    <h5>üìà Performance Trend</h5>

    {% if subjects %}
        <canvas id="scoreChart"></canvas>
    {% else %}
        <p class="text-muted">No performance data available yet.</p>
    {% endif %}
</div>

<!-- SUBJECT PROGRESS -->
<div class="card mt-4 p-3 shadow-sm">
    <h5>üìö Subject-wise Progress</h5>

    {% if subjects %}
        {% for i in range(subjects|length) %}
        <div class="mb-3">
            <strong>{{ subjects[i] }}</strong>
            <div class="progress">
                <div class="progress-bar bg-success"
                     style="width: {{ scores[i] }}%">
                     {{ scores[i] }}%
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <p class="text-muted">Attempt tests to see subject progress.</p>
    {% endif %}
</div>

<!-- INSIGHTS -->
<div class="row mt-4">

    <div class="col-md-6">
        <div class="card p-3 shadow-sm">
            <h5>üí™ Strong Area</h5>

            {% if subjects %}
                <p>{{ subjects[scores.index(scores|max)] }}</p>
            {% else %}
                <p>No Data</p>
            {% endif %}
        </div>
    </div>

    <div class="col-md-6">
        <div class="card p-3 shadow-sm">
            <h5>‚ö†Ô∏è Needs Improvement</h5>

            {% if subjects %}
                <p>{{ subjects[scores.index(scores|min)] }}</p>
            {% else %}
                <p>No Data</p>
            {% endif %}
        </div>
    </div>

</div>

<!-- ACHIEVEMENTS -->
<div class="card mt-4 p-3 shadow-sm">
    <h5>üèÜ Achievements</h5>

    {% if total_tests >= 5 %}
        <span class="badge bg-success">5+ Tests Completed</span>
    {% endif %}

    {% if avg_score >= 80 %}
        <span class="badge bg-warning text-dark">Top Performer</span>
    {% endif %}

    {% if avg_score >= 60 %}
        <span class="badge bg-info">Consistent Learner</span>
    {% endif %}

    {% if total_tests == 0 %}
        <p class="text-muted mt-2">Start attempting tests to unlock achievements.</p>
    {% endif %}
</div>

</div>
</div>
</div>
</div>
<!-- CHART SCRIPT -->
<script>
const subjects = {{ subjects | tojson }};
const scores = {{ scores | tojson }};

if (subjects.length > 0) {
    new Chart(document.getElementById("scoreChart"), {
        type: "line",
        data: {
            labels: subjects,
            datasets: [{
                label: "Score (%)",
                data: scores,
                borderWidth: 3,
                fill: false,
                tension: 0.3
            }]
        }
    });
}
</script>

<!-- COUNTER ANIMATION -->
<script>
document.querySelectorAll(".counter").forEach(counter => {
    const target = +counter.getAttribute("data-target");
    let count = 0;
    const update = () => {
        if(count < target){
            count += Math.ceil(target / 40);
            counter.innerText = count;
            setTimeout(update, 30);
        } else {
            counter.innerText = target;
        }
    };
    update();
});
</script>

<!-- DARK MODE -->
<script>
document.addEventListener("DOMContentLoaded", function(){

    const toggle = document.getElementById("darkToggle");

    if(localStorage.getItem("darkMode") === "enabled"){
        document.body.classList.add("dark-mode");
        toggle.checked = true;
    }

    toggle.addEventListener("change", function(){
        document.body.classList.toggle("dark-mode");

        if(document.body.classList.contains("dark-mode")){
            localStorage.setItem("darkMode","enabled");
        }else{
            localStorage.setItem("darkMode","disabled");
        }
    });

    // Hide loader
    document.getElementById("pageLoader").style.display = "none";
});

function toggleSidebar(){
    document.querySelector(".sidebar").classList.toggle("collapsed");
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
